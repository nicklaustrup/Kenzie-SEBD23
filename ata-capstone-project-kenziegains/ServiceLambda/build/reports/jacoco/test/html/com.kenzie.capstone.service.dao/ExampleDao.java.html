<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExampleDao.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ServiceLambda</a> &gt; <a href="index.source.html" class="el_package">com.kenzie.capstone.service.dao</a> &gt; <span class="el_source">ExampleDao.java</span></div><h1>ExampleDao.java</h1><pre class="source lang-java linenums">package com.kenzie.capstone.service.dao;

import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBScanExpression;
import com.amazonaws.services.dynamodbv2.model.AttributeValue;
import com.kenzie.capstone.service.converter.LocalDateTimeConverter;
import com.kenzie.capstone.service.model.*;

import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper;
import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBQueryExpression;
import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBSaveExpression;
import com.amazonaws.services.dynamodbv2.model.ConditionalCheckFailedException;
import com.amazonaws.services.dynamodbv2.model.ExpectedAttributeValue;
import com.google.common.collect.ImmutableMap;

import java.time.LocalDateTime;
import java.util.List;

public class ExampleDao {
    private DynamoDBMapper mapper;

    /**
     * Allows access to and manipulation of Match objects from the data store.
     * @param mapper Access to DynamoDB
     */
<span class="nc" id="L25">    public ExampleDao(DynamoDBMapper mapper) {</span>
<span class="nc" id="L26">        this.mapper = mapper;</span>
<span class="nc" id="L27">    }</span>

//    public ExampleData storeExampleData(ExampleData exampleData) {
//        try {
//            mapper.save(exampleData, new DynamoDBSaveExpression()
//                    .withExpected(ImmutableMap.of(
//                            &quot;id&quot;,
//                            new ExpectedAttributeValue().withExists(false)
//                    )));
//        } catch (ConditionalCheckFailedException e) {
//            throw new IllegalArgumentException(&quot;id has already been used&quot;);
//        }
//
//        return exampleData;
//    }

//    public List&lt;ExampleRecord&gt; getExampleData(String id) {
//        ExampleRecord exampleRecord = new ExampleRecord();
//        exampleRecord.setId(id);
//
//        DynamoDBQueryExpression&lt;ExampleRecord&gt; queryExpression = new DynamoDBQueryExpression&lt;ExampleRecord&gt;()
//                .withHashKeyValues(exampleRecord)
//                .withConsistentRead(false);
//
//        return mapper.query(ExampleRecord.class, queryExpression);
//    }

//    public ExampleRecord setExampleData(String id, String data) {
//        ExampleRecord exampleRecord = new ExampleRecord();
//        exampleRecord.setId(id);
//        exampleRecord.setData(data);
//
//        try {
//            mapper.save(exampleRecord, new DynamoDBSaveExpression()
//                    .withExpected(ImmutableMap.of(
//                            &quot;id&quot;,
//                            new ExpectedAttributeValue().withExists(false)
//                    )));
//        } catch (ConditionalCheckFailedException e) {
//            throw new IllegalArgumentException(&quot;id already exists&quot;);
//        }
//
//        return exampleRecord;
//    }

    //Set additional methods for each of the classes/tables
    public List&lt;InstructorLeadClassRecord&gt; getInstructorLeadClassData(String classId) {
<span class="nc" id="L74">        InstructorLeadClassRecord instructorLeadClassRecord = new InstructorLeadClassRecord();</span>
<span class="nc" id="L75">        instructorLeadClassRecord.setClassId(classId);</span>

<span class="nc" id="L77">        DynamoDBQueryExpression&lt;InstructorLeadClassRecord&gt; queryExpression = new DynamoDBQueryExpression&lt;InstructorLeadClassRecord&gt;()</span>
<span class="nc" id="L78">                .withHashKeyValues(instructorLeadClassRecord)</span>
<span class="nc" id="L79">                .withConsistentRead(false);</span>

<span class="nc" id="L81">        return mapper.query(InstructorLeadClassRecord.class, queryExpression);</span>
    }

    public List&lt;InstructorLeadClassRecord&gt; getAllInstructorLeadClassData() {
<span class="nc" id="L85">        DynamoDBScanExpression scanQueryExpression = new DynamoDBScanExpression();</span>
<span class="nc" id="L86">        return mapper.scan(InstructorLeadClassRecord.class, scanQueryExpression);</span>

    }
    public InstructorLeadClassRecord setInstructorLeadClassData(String classId, String name, String description, String classType, String userId, int classCapacity, String dateTime, boolean status) {
<span class="nc" id="L90">        LocalDateTimeConverter converter = new LocalDateTimeConverter();</span>
<span class="nc" id="L91">        InstructorLeadClassRecord instructorLeadClassRecord = new InstructorLeadClassRecord();</span>
<span class="nc" id="L92">        instructorLeadClassRecord.setClassId(classId);</span>
<span class="nc" id="L93">        instructorLeadClassRecord.setName(name);</span>
<span class="nc" id="L94">        instructorLeadClassRecord.setDescription(description);</span>
<span class="nc" id="L95">        instructorLeadClassRecord.setClassType(classType);</span>
<span class="nc" id="L96">        instructorLeadClassRecord.setUserId(userId);</span>
<span class="nc" id="L97">        instructorLeadClassRecord.setClassCapacity(classCapacity);</span>
<span class="nc" id="L98">        instructorLeadClassRecord.setDateTime(converter.unconvert(dateTime));</span>
<span class="nc" id="L99">        instructorLeadClassRecord.setStatus(status);</span>

        try {
<span class="nc" id="L102">            mapper.save(instructorLeadClassRecord, new DynamoDBSaveExpression()</span>
<span class="nc" id="L103">                    .withExpected(ImmutableMap.of(</span>
                            &quot;classId&quot;,
<span class="nc" id="L105">                            new ExpectedAttributeValue().withExists(false)</span>
                    )));
<span class="nc" id="L107">        } catch (ConditionalCheckFailedException e) {</span>
<span class="nc" id="L108">            throw new IllegalArgumentException(&quot;classId already exists&quot;);</span>
<span class="nc" id="L109">        }</span>

<span class="nc" id="L111">        return instructorLeadClassRecord;</span>
    }

    public InstructorLeadClassRecord updateInstructorLeadClassData(String classId, String name, String description, String classType, String userId, int classCapacity, String dateTime, boolean status) {
<span class="nc" id="L115">        LocalDateTimeConverter converter = new LocalDateTimeConverter();</span>
<span class="nc" id="L116">        InstructorLeadClassRecord instructorLeadClassRecord = new InstructorLeadClassRecord();</span>
<span class="nc" id="L117">        instructorLeadClassRecord.setClassId(classId);</span>
<span class="nc" id="L118">        instructorLeadClassRecord.setName(name);</span>
<span class="nc" id="L119">        instructorLeadClassRecord.setDescription(description);</span>
<span class="nc" id="L120">        instructorLeadClassRecord.setClassType(classType);</span>
<span class="nc" id="L121">        instructorLeadClassRecord.setUserId(userId);</span>
<span class="nc" id="L122">        instructorLeadClassRecord.setClassCapacity(classCapacity);</span>
<span class="nc" id="L123">        instructorLeadClassRecord.setDateTime(converter.unconvert(dateTime));</span>
<span class="nc" id="L124">        instructorLeadClassRecord.setStatus(status);</span>

        try {
<span class="nc" id="L127">            mapper.save(instructorLeadClassRecord);</span>
//            mapper.save(instructorLeadClassRecord, new DynamoDBSaveExpression()
//                    .withExpected(ImmutableMap.of(
//                            &quot;classId&quot;,
//                            new ExpectedAttributeValue().withExists(false)
//                    )));
<span class="nc" id="L133">        } catch (Exception e) {</span>
<span class="nc" id="L134">            throw new IllegalArgumentException(&quot;Error updating&quot;);</span>
<span class="nc" id="L135">        }</span>

<span class="nc" id="L137">        return instructorLeadClassRecord;</span>
    }


    //User Tables
    public List&lt;UserRecord&gt; getUserData(String username) {
<span class="nc" id="L143">        UserRecord record = new UserRecord();</span>
<span class="nc" id="L144">        record.setUsername(username);</span>

<span class="nc" id="L146">        DynamoDBQueryExpression&lt;UserRecord&gt; queryExpression = new DynamoDBQueryExpression&lt;UserRecord&gt;()</span>
<span class="nc" id="L147">                .withHashKeyValues(record)</span>
<span class="nc" id="L148">                .withConsistentRead(false);</span>

<span class="nc" id="L150">        return mapper.query(UserRecord.class, queryExpression);</span>
    }

    public List&lt;UserRecord&gt; getAllUsersData() {
<span class="nc" id="L154">        DynamoDBScanExpression scanExpression = new DynamoDBScanExpression();</span>
<span class="nc" id="L155">        return mapper.scan(UserRecord.class, scanExpression);</span>
    }

    public UserRecord setUserData(UserData data) {
<span class="nc" id="L159">        UserRecord record = new UserRecord();</span>
<span class="nc" id="L160">        record.setUserId(data.getUserId());</span>
<span class="nc" id="L161">        record.setUsername(data.getUsername());</span>
<span class="nc" id="L162">        record.setFirstName(data.getFirstName());</span>
<span class="nc" id="L163">        record.setLastName(data.getLastName());</span>
<span class="nc" id="L164">        record.setMembership(data.getMembership());</span>
<span class="nc" id="L165">        record.setStatus(data.getStatus());</span>
<span class="nc" id="L166">        record.setUserType(data.getUserType());</span>
<span class="nc" id="L167">        record.setPassword(data.getPassword());</span>


        try {
<span class="nc" id="L171">            mapper.save(record, new DynamoDBSaveExpression()</span>
<span class="nc" id="L172">                    .withExpected(ImmutableMap.of(</span>
                            &quot;username&quot;,
<span class="nc" id="L174">                            new ExpectedAttributeValue().withExists(false)</span>
                    )));
<span class="nc" id="L176">        } catch (ConditionalCheckFailedException e) {</span>
<span class="nc" id="L177">            throw new IllegalArgumentException(&quot;username already exists&quot;);</span>
<span class="nc" id="L178">        }</span>

<span class="nc" id="L180">        return record;</span>
    }
    public UserRecord updateUserData(UserData data) {
<span class="nc" id="L183">        UserRecord record = new UserRecord();</span>
<span class="nc" id="L184">        record.setUserId(data.getUserId());</span>
<span class="nc" id="L185">        record.setUsername(data.getUsername());</span>
<span class="nc" id="L186">        record.setFirstName(data.getFirstName());</span>
<span class="nc" id="L187">        record.setLastName(data.getLastName());</span>
<span class="nc" id="L188">        record.setMembership(data.getMembership());</span>
<span class="nc" id="L189">        record.setStatus(data.getStatus());</span>
<span class="nc" id="L190">        record.setUserType(data.getUserType());</span>
<span class="nc" id="L191">        record.setPassword(data.getPassword());</span>

<span class="nc" id="L193">        String username = record.getUsername();</span>


        try {
<span class="nc" id="L197">            mapper.save(record, new DynamoDBSaveExpression()</span>
<span class="nc" id="L198">                    .withExpected(ImmutableMap.of(</span>
                            &quot;username&quot;,
                            new ExpectedAttributeValue(new AttributeValue(username))
<span class="nc" id="L201">                                    .withExists(true)</span>
                    )));
<span class="nc" id="L203">        } catch (ConditionalCheckFailedException e) {</span>
<span class="nc" id="L204">            throw new IllegalArgumentException(&quot;username does not exist, register a new user&quot;);</span>
<span class="nc" id="L205">        }</span>

<span class="nc" id="L207">        return record;</span>
    }

    // Class Attendance Tables

    public List&lt;ClassAttendanceRecord&gt; getAttendanceData(String userId, String classId) {
<span class="nc" id="L213">        ClassAttendanceCompositeId compositeId = new ClassAttendanceCompositeId();</span>
<span class="nc" id="L214">        compositeId.setUserId(userId);</span>
<span class="nc" id="L215">        compositeId.setClassId(classId);</span>

<span class="nc" id="L217">        ClassAttendanceRecord record = new ClassAttendanceRecord();</span>
<span class="nc" id="L218">        record.setUserId(userId);</span>
<span class="nc" id="L219">        record.setClassId(classId);</span>

<span class="nc" id="L221">        DynamoDBQueryExpression&lt;ClassAttendanceRecord&gt; queryExpression = new DynamoDBQueryExpression&lt;ClassAttendanceRecord&gt;()</span>
<span class="nc" id="L222">                .withHashKeyValues(record)</span>
<span class="nc" id="L223">                .withConsistentRead(false);</span>

<span class="nc" id="L225">        return mapper.query(ClassAttendanceRecord.class, queryExpression);</span>
    }

    public ClassAttendanceRecord setAttendanceData(String userId, String classId, String attendanceStatus) {

<span class="nc" id="L230">        ClassAttendanceRecord record = new ClassAttendanceRecord();</span>
<span class="nc" id="L231">        record.setUserId(userId);</span>
<span class="nc" id="L232">        record.setClassId(classId);</span>
<span class="nc" id="L233">        record.setAttendanceStatus(attendanceStatus);</span>

        try {
<span class="nc" id="L236">            mapper.save(record, new DynamoDBSaveExpression()</span>
<span class="nc" id="L237">                    .withExpected(ImmutableMap.of(</span>
                            &quot;id&quot;,
<span class="nc" id="L239">                            new ExpectedAttributeValue().withExists(false)</span>
                    )));
<span class="nc" id="L241">        } catch (ConditionalCheckFailedException e) {</span>
<span class="nc" id="L242">            throw new IllegalArgumentException(&quot;Attendance already exists&quot;);</span>
<span class="nc" id="L243">        }</span>

<span class="nc" id="L245">        return record;</span>
    }
    public List&lt;ClassAttendanceRecord&gt; getAllClassAttendanceData() {
<span class="nc" id="L248">        DynamoDBScanExpression scanQueryExpression = new DynamoDBScanExpression();</span>
<span class="nc" id="L249">        return mapper.scan(ClassAttendanceRecord.class, scanQueryExpression);</span>

    }

    public ClassAttendanceRecord updateClassAttendanceData(String userId, String classId, String attendanceStatus) {
<span class="nc" id="L254">        ClassAttendanceRecord classAttendanceRecord = new ClassAttendanceRecord();</span>
<span class="nc" id="L255">        classAttendanceRecord.setUserId(userId);</span>
<span class="nc" id="L256">        classAttendanceRecord.setClassId(classId);</span>
<span class="nc" id="L257">        classAttendanceRecord.setAttendanceStatus(attendanceStatus);</span>
        try {
<span class="nc" id="L259">            mapper.save(classAttendanceRecord);</span>
<span class="nc" id="L260">        } catch (Exception e) {</span>
<span class="nc" id="L261">            throw new IllegalArgumentException(&quot;Error updating&quot;);</span>
<span class="nc" id="L262">        }</span>
<span class="nc" id="L263">        return classAttendanceRecord;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>